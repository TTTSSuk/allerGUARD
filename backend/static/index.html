<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllerGUARD ‚Äì AI Label Checker</title>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --bg: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--secondary);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        h1 {
            text-align: center;
            color: var(--secondary);
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .upload-section {
            background: #f1f7ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        label {
            font-weight: bold;
            display: block;
            margin-top: 15px;
        }

        input[type="file"], input[type="text"] {
            width: 100%;
            margin-top: 8px;
            margin-bottom: 16px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        button:disabled {
            background-color: #bdc3c7;
        }

        /* Result Sections */
        .result-container {
            margin-top: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .result-container { grid-template-columns: 1fr; }
        }

        .card {
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 20px;
            background: #fff;
        }

        .card h2 {
            margin-top: 0;
            font-size: 1.2rem;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        /* Ingredient Tags */
        .ingredient-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            list-style: none;
            padding: 0;
        }

        .ingredient-tag {
            background: #edf2f7;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid #cbd5e0;
        }

        /* Risk Cards */
        .risk-item {
            border-left: 5px solid var(--danger);
            background: #fff5f5;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .risk-item.Medium { border-left-color: var(--warning); background: #fffaf0; }
        .risk-item.Low { border-left-color: var(--primary); background: #ebf8ff; }

        .risk-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }

        .badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            color: white;
        }

        .badge.High { background: var(--danger); }
        .badge.Medium { background: var(--warning); }
        .badge.Low { background: var(--primary); }

        .summary-box {
            grid-column: 1 / -1;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .safe { background: #e8f5e9; color: var(--success); border: 1px solid var(--success); }
        .unsafe { background: #ffebee; color: var(--danger); border: 1px solid var(--danger); }

        #loading { display: none; text-align: center; margin: 20px 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>AllerGUARD üß™</h1>
    
    <div class="upload-section">
        <p>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏â‡∏•‡∏≤‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ</p>
        
        <label>üì∏ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏â‡∏•‡∏≤‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
        <input type="file" id="imageInput" accept="image/*">

        <label>‚ö†Ô∏è ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ (‡πÄ‡∏ä‡πà‡∏ô salicylate, fragrance)</label>
        <input type="text" id="allergiesInput" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ (,)">

        <button id="analyzeBtn" onclick="analyze()" style="width: 100%;">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏â‡∏•‡∏≤‡∏Å‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ</button>
    </div>

    <div id="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</div>

    <div id="resultArea" style="display: none;">
        <div id="summaryResult" class="summary-box"></div>

        <div class="result-container">
            <div class="card">
                <h2>üß™ ‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö</h2>
                <div id="ingredientList" class="ingredient-list"></div>
            </div>

            <div class="card">
                <h2>üö´ ‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á</h2>
                <div id="analysisResult"></div>
            </div>
        </div>
    </div>
</div>

<script>
async function analyze() {
    const fileInput = document.getElementById("imageInput");
    const allergiesInput = document.getElementById("allergiesInput");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const loading = document.getElementById("loading");
    const resultArea = document.getElementById("resultArea");
    
    const ingredientList = document.getElementById("ingredientList");
    const analysisResult = document.getElementById("analysisResult");
    const summaryResult = document.getElementById("summaryResult");

    if (!fileInput.files.length) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û");
        return;
    }

    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
    ingredientList.innerHTML = "";
    analysisResult.innerHTML = "";
    resultArea.style.display = "none";
    loading.style.display = "block";
    analyzeBtn.disabled = true;

    const allergies = allergiesInput.value
        .split(",")
        .map(a => a.trim().toLowerCase())
        .filter(a => a.length > 0);

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);
    formData.append("allergies", JSON.stringify(allergies));

    try {
        const response = await fetch("/analyze-label", {
            method: "POST",
            body: formData
        });

        const data = await response.json();
        loading.style.display = "none";
        resultArea.style.display = "block";

        if (data.error) {
            summaryResult.className = "summary-box unsafe";
            summaryResult.innerHTML = `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${data.error}`;
            return;
        }

        // 1Ô∏è‚É£ ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡πÄ‡∏õ‡πá‡∏ô Tag ‡∏™‡∏ß‡∏¢‡πÜ
        data.ingredients.forEach(item => {
            const span = document.createElement("span");
            span.className = "ingredient-tag";
            span.textContent = item.corrected;
            ingredientList.appendChild(span);
        });

        // 2Ô∏è‚É£ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ
        const risky = data.analysis.risky_ingredients;

        if (!risky || risky.length === 0) {
            summaryResult.className = "summary-box safe";
            summaryResult.innerHTML = "‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢! ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ‡πÉ‡∏ô‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ô‡∏µ‡πâ";
            analysisResult.innerHTML = "<p style='text-align:center; color:#666;'>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏≤‡∏£‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</p>";
        } else {
            summaryResult.className = "summary-box unsafe";
            summaryResult.innerHTML = `‚ö†Ô∏è ‡∏û‡∏ö‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á ${risky.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

            risky.forEach(r => {
                const riskCard = document.createElement("div");
                riskCard.className = `risk-item ${r.risk_level}`;
                riskCard.innerHTML = `
                    <div class="risk-header">
                        <span>${r.name}</span>
                        <span class="badge ${r.risk_level}">${r.risk_level}</span>
                    </div>
                    <div style="font-size: 0.85rem; margin-top: 5px; color: #555;">
                        <b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</b> ${r.reason}
                    </div>
                `;
                analysisResult.appendChild(riskCard);
            });
            
            const summaryText = document.createElement("p");
            summaryText.innerHTML = `<br><b>‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å AI:</b><br>${data.analysis.summary}`;
            analysisResult.appendChild(summaryText);
        }

    } catch (err) {
        loading.style.display = "none";
        summaryResult.className = "summary-box unsafe";
        summaryResult.innerHTML = `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö: ${err}`;
    } finally {
        analyzeBtn.disabled = false;
    }
}
</script>

</body>
</html>