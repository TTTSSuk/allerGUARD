<!DOCTYPE html>
<html>
<head>
    <title>AllerGuard - AI Allergen Checker</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; line-height: 1.6; }
        .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; box-shadow: 2px 2px 10px #eee; }
        .result { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; }
        .danger { background: #ffebee; border: 1px solid #ef5350; }
        .safe { background: #e8f5e9; border: 1px solid #66bb6a; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üõ°Ô∏è AllerGuard</h2>
        <p>‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡∏±‡πà‡∏ß, Salicylic Acid, Paraben):</p>
        <input type="text" id="allergies" style="width:100%; padding:10px;" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ñ‡∏±‡πà‡∏ß, ‡∏ô‡∏°, BHA">
        
        <p>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏â‡∏•‡∏≤‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</p>
        <input type="file" id="imageInput" accept="image/*">
        <br><br>
        <button onclick="analyze()" style="background:#007bff; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ AI</button>
    </div>

    <div id="resultArea" class="result"></div>

    <script>
        async function analyze() {
            const file = document.getElementById('imageInput').files[0];
            const allergyText = document.getElementById('allergies').value;
            const resultArea = document.getElementById('resultArea');
            
            if(!file) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û");

            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á‡πÑ‡∏õ Backend
            const formData = new FormData();
            formData.append('file', file);
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏õ‡πá‡∏ô Array JSON
            const allergyArray = allergyText.split(',').map(s => s.trim());
            formData.append('allergies', JSON.stringify(allergyArray));

            resultArea.style.display = 'block';
            resultArea.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI...";

            try {
                const response = await fetch('/analyze-label', { method: 'POST', body: formData });
                const data = await response.json();
                
                let html = `<h3>‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö:</h3><p>${data.cleaned_ingredients.join(', ')}</p>`;
                
                if(data.detected_allergens.length > 0) {
                    resultArea.className = "result danger";
                    html += `<h3>‚ö†Ô∏è ‡∏û‡∏ö‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏û‡πâ!</h3>`;
                    data.detected_allergens.forEach(a => {
                        html += `<p><b>${a.ingredient}</b>: ${a.reason} (‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á: ${a.level})</p>`;
                    });
                } else {
                    resultArea.className = "result safe";
                    html += `<h3>‚úÖ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÅ‡∏û‡πâ</h3>`;
                }
                
                html += `<hr><h4>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</h4><p>${data.recommendation}</p>`;
                html += `<h4>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</h4><ul>${data.alternative_products.map(p => `<li>${p}</li>`).join('')}</ul>`;
                
                resultArea.innerHTML = html;
            } catch (err) {
                resultArea.innerHTML = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
            }
        }
    </script>
</body>
</html>